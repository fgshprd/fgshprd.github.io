<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Custom Elements</title>
    <style type="text/css">
        x-ad-shell {
            display: block;
            width: 320px;
            height: 50px;
            margin: 0 auto;
        }
        p { 
            color: red;
        }
    </style>
</head>
<body>
    <p>Test Text in a p tag</p>
    <script type="text/javascript">
        var XAdShellProto = Object.create(HTMLElement.prototype),
            XEventHubProto = Object.create(HTMLElement.prototype),
            XBasicBannerProto = Object.create(HTMLElement.prototype),
            XBasicPanelProto = Object.create(HTMLElement.prototype);
        /* Proto lifecycle callbacks */
        XAdShellProto.createdCallback = function () {
            console.log(this.localName + ' created');
        };
        XAdShellProto.attachedCallback = function () {
            console.log(this.localName + ' attached');
            this.init();
        };
        XAdShellProto.detachedCallback = function () {
            console.log(this.localName + ' detached');
        };
        XAdShellProto.attributeChangeCallback = function (attrName, oldVal, newVal) {
            console.log(this.localName + ' attribute changed');
        };
        XEventHubProto.createdCallback = function () {
            console.log(this.localName + ' created');
        };
        XEventHubProto.attachedCallback = function () {
            console.log(this.localName + ' attached');
        };
        XEventHubProto.detachedCallback = function () {
            console.log(this.localName + ' detached');
        };
        XEventHubProto.attributeChangeCallback = function (attrName, oldVal, newVal) {
            console.log(this.localName + ' attribute changed');
        };
        XBasicBannerProto.createdCallback = function () {
            console.log(this.localName + ' created');
            this.innerHTML = "<p>Banner</p>";
        };
        XBasicBannerProto.attachedCallback = function () {
            var styleObj = {
                display: 'block',
                border: '1px solid black',
                textAlign: 'center',
                width: '100%'
            };
            console.log(this.localName + ' attached');
            adShell.setStyles('x-basic-banner', styleObj);
        };
        XBasicBannerProto.detachedCallback = function () {
            console.log(this.localName + ' detached');
        };
        XBasicBannerProto.attributeChangeCallback = function (attrName, oldVal, newVal) {
            console.log(this.localName + ' attribute changed');
        };
        XBasicPanelProto.createdCallback = function () {
            console.log(this.localName + ' created');
            this.innerHTML = "<p>Panel</p>";
        };
        XBasicPanelProto.attachedCallback = function () {
            var styleObj = {
                display: 'block',
                border: '1px solid black',
                textAlign: 'center',
                width: '100%',
                height: '250px'
            };
            console.log(this.localName + ' attached');
            adShell.setStyles('x-basic-panel', styleObj);
            styleObj = { color: 'green' };
            adShell.setStyles('p', styleObj);
        };
        XBasicPanelProto.detachedCallback = function () {
            console.log(this.localName + ' detached');
        };
        XBasicPanelProto.attributeChangeCallback = function (attrName, oldVal, newVal) {
            console.log(this.localName + ' attribute changed');
        };
        /* Custom methods */
        XAdShellProto.init = function (configObj) {
            var config = configObj || {},
                xEventHub = document.registerElement('x-event-hub', {prototype: XEventHubProto}),
                xBasicBanner = document.registerElement('x-basic-banner', {prototype: XBasicBannerProto}),
                xBasicPanel = document.registerElement('x-basic-panel', {prototype: XBasicPanelProto}),
                eventHub = document.createElement('x-event-hub'),
                banner = document.createElement('x-basic-banner'),
                panel = document.createElement('x-basic-panel'),
                styles = document.createElement('style'),
                shadow = this.webkitCreateShadowRoot();
            panel.className = 'hide';
            shadow.appendChild(styles);
            shadow.appendChild(eventHub);
            shadow.appendChild(banner);
            shadow.appendChild(panel);
            eventHub.addEventListener('expand', function (event) { 
                console.log(this.localName + ': expand received');
                var banner = shadow.querySelector('x-basic-banner'),
                    panel = shadow.querySelector('x-basic-panel');
                banner.className = 'hide';
                panel.className = 'show';
            }, false);
            banner.addEventListener('click', banner.expand, false);
            this.hub = eventHub;
            this.setStyles('.hide', {display: 'none'});
            this.setStyles('.show', {display: 'block'});
        };
        XAdShellProto.setStyles = function (selector, styles) {
            var cssString = JSON.stringify(styles).replace(/,/g, ';').replace(/"/g, '').replace(/([A-Z])/g, '-$&').toLowerCase(),
                shadow = this.webkitShadowRoot,
                styles = shadow.querySelector('style');
            styles.innerHTML += selector + ' ' + cssString + '\n';
            return styles;
        };
        XBasicBannerProto.expand = function() {
            var event = new Event('expand'),
                host = document.querySelector('x-ad-shell'),
                hub = host.hub;
            console.log(this.localName + ': expand');
            hub.dispatchEvent(event);
        };
        var xAdShell = document.registerElement('x-ad-shell', {prototype: XAdShellProto}),
            adShell = document.createElement('x-ad-shell');
        document.body.appendChild(adShell);
    </script>
</body>
</html>